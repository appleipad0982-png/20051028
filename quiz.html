<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>線上測驗系統</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .back-btn {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .quiz-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #667eea;
            font-size: 1.2rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .question-text {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option {
            padding: 1.2rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .option:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option.correct {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .option.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .button-container {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .result-card {
            text-align: center;
        }

        .result-score {
            font-size: 4rem;
            color: #667eea;
            font-weight: bold;
            margin: 2rem 0;
        }

        .result-details {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 2rem;
        }

        .emoji {
            font-size: 5rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .quiz-card {
                padding: 1.5rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-btn">← 返回首頁</a>
            <h1>📝 線上測驗系統</h1>
            <p>測試你的學習成果</p>
        </div>

        <div class="quiz-card" id="quizCard">
            <div class="loading" id="loading">
                正在載入題目...
            </div>
        </div>
    </div>

    <script>
        let questions = [];
        let currentQuestion = 0;
        let userAnswers = [];
        let score = 0;

        // 載入 CSV 題目
        async function loadQuestions() {
            try {
                const response = await fetch('questions.csv');
                const csvText = await response.text();
                
                // 解析 CSV
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length >= 5) {
                        questions.push({
                            question: values[0],
                            options: [values[1], values[2], values[3], values[4]],
                            correct: values[5].trim().toUpperCase()
                        });
                    }
                }

                // 隨機打亂題目
                questions = shuffleArray(questions);
                
                document.getElementById('loading').style.display = 'none';
                displayQuestion();
            } catch (error) {
                document.getElementById('loading').innerHTML = `
                    <p style="color: #f44336;">❌ 無法載入題目檔案</p>
                    <p style="font-size: 0.9rem; color: #999;">請確認 questions.csv 檔案存在</p>
                `;
            }
        }

        // 解析 CSV 行（處理引號內的逗號）
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            
            return result.map(v => v.replace(/"/g, ''));
        }

        // 打亂陣列
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // 顯示題目
        function displayQuestion() {
            const question = questions[currentQuestion];
            const progress = ((currentQuestion + 1) / questions.length) * 100;

            document.getElementById('quizCard').innerHTML = `
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progress}%"></div>
                </div>
                <div class="question-number">
                    題目 ${currentQuestion + 1} / ${questions.length}
                </div>
                <div class="question-text">${question.question}</div>
                <div class="options" id="options">
                    ${question.options.map((option, index) => `
                        <div class="option" onclick="selectOption('${String.fromCharCode(65 + index)}')">
                            <strong>${String.fromCharCode(65 + index)}.</strong> ${option}
                        </div>
                    `).join('')}
                </div>
                <div class="button-container">
                    <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" disabled>
                        ${currentQuestion === questions.length - 1 ? '查看結果' : '下一題'} →
                    </button>
                </div>
            `;
        }

        // 選擇答案
        function selectOption(answer) {
            // 移除所有選中狀態
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // 標記當前選中
            event.currentTarget.classList.add('selected');
            
            // 儲存答案
            userAnswers[currentQuestion] = answer;
            
            // 啟用下一題按鈕
            document.getElementById('nextBtn').disabled = false;
        }

        // 下一題
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                displayQuestion();
            } else {
                calculateScore();
                showResults();
            }
        }

        // 計算分數
        function calculateScore() {
            score = 0;
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === questions[i].correct) {
                    score++;
                }
            }
        }

        // 顯示結果
        function showResults() {
            const percentage = Math.round((score / questions.length) * 100);
            let emoji = '🎉';
            let message = '太棒了！';

            if (percentage < 60) {
                emoji = '📚';
                message = '繼續努力！';
            } else if (percentage < 80) {
                emoji = '👍';
                message = '做得不錯！';
            }

            document.getElementById('quizCard').innerHTML = `
                <div class="result-card">
                    <div class="emoji">${emoji}</div>
                    <h2>${message}</h2>
                    <div class="result-score">${percentage}分</div>
                    <div class="result-details">
                        總題數：${questions.length} 題<br>
                        答對：${score} 題<br>
                        答錯：${questions.length - score} 題
                    </div>
                    <div class="button-container">
                        <button class="btn btn-primary" onclick="location.reload()">
                            🔄 重新測驗
                        </button>
                        <button class="btn btn-primary" onclick="location.href='index.html'" style="background: #6c757d;">
                            🏠 返回首頁
                        </button>
                    </div>
                </div>
            `;
        }

        // 頁面載入時執行
        window.addEventListener('DOMContentLoaded', loadQuestions);
    </script>
</body>
</html>